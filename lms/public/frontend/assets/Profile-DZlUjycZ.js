var q=Object.defineProperty;var F=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var I=(_,u,l)=>u in _?q(_,u,{enumerable:!0,configurable:!0,writable:!0,value:l}):_[u]=l,B=(_,u)=>{for(var l in u||(u={}))D.call(u,l)&&I(_,l,u[l]);if(F)for(var l of F(u))H.call(u,l)&&I(_,l,u[l]);return _};import{d as R,$ as L,x as c,y as h,B as t,aa as $,C as p,A as e,N as d,H as f,I as C,F as V,ad as O,ae as G,a as J,k as U,w as z,G as P,aw as A,ai as j,D as K,r as T,V as X,ax as Y,ay as Z,az as Q,K as W,J as M,aA as ee,s as ae,aB as se,j as te,T as oe,b as le,ag as re,a9 as ie,aC as ne,S as de}from"./frappe-ui-CgFK8870.js";import{b as ue,i as me,d as ce,s as pe,j as fe}from"./index-GARLdoCV.js";import{_ as _e}from"./UserAvatar-CMVzFlfz.js";import{F as ve}from"./file-text-DHp4eWlu.js";import{X as ge}from"./x-KQP2i48Y.js";/**
 * @license lucide-vue-next v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=ue("SquarePenIcon",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),be={class:"border rounded-md w-1/3 mx-auto my-32"},he={class:"border-b px-5 py-3 font-medium"},xe=t("span",{class:"inline-flex items-center before:bg-red-600 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1),ye={key:0,class:"px-5 py-3"},ke={class:"px-5 py-3"},we={__name:"NoPermission",setup(_){const u=R("$user"),l=()=>{window.location.href="/login"};return(s,x)=>{const g=L("router-link");return c(),h("div",be,[t("div",he,[xe,$(" "+p(s.__("Not Permitted")),1)]),e(u).data?(c(),h("div",ye,[t("div",null,p(s.__("You do not have permission to access this page.")),1),d(g,{to:{name:"Courses"}},{default:f(()=>[d(e(C),{variant:"solid",class:"mt-2"},{default:f(()=>[$(p(s.__("Checkout Courses")),1)]),_:1})]),_:1})])):V("",!0),t("div",ke,[t("div",null,p(s.__("Please login to access this page.")),1),d(e(C),{variant:"solid",onClick:x[0]||(x[0]=w=>l()),class:"mt-2"},{default:f(()=>[$(p(s.__("Login")),1)]),_:1})])])}}},$e={class:"mb-4"},Pe={key:1,class:"mb-4"},Ce={class:"text-xs text-gray-600 mb-1"},Ve={class:"flex items-center"},Ue={class:"border rounded-md p-2 mr-2"},Se={class:"text-base flex flex-col"},je={class:"text-sm text-gray-500 mt-1"},Ee={__name:"EditProfile",props:O({profile:{type:Object,required:!0}},{reloadProfile:{},reloadProfileModifiers:{}}),emits:["update:reloadProfile"],setup(_){const u=G(_,"reloadProfile"),l=_,s=J({first_name:"",last_name:"",headline:"",bio:"",image:""}),x=U({url:"lms.lms.api.get_file_info",makeParams(a){return{file_url:a.image}},auto:!1,onSuccess(a){s.image=a}}),g=U({url:"frappe.client.set_value",makeParams(a){return{doctype:"User",name:l.profile.data.name,fieldname:B({user_image:s.image.file_url},s)}},onSuccess(a){l.profile.data=a}}),w=a=>{g.submit({},{onSuccess(){a(),u.value.reload()},onError(i){var n;ce("Error",((n=i.messages)==null?void 0:n[0])||i,"x")}})},b=a=>{let i=a.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(i))return"Only image file is allowed."},o=a=>{s.image=a},v=()=>{s.image=null};return z(()=>l.profile.data,a=>{a&&(s.first_name=a.first_name,s.last_name=a.last_name,s.headline=a.headline,s.bio=a.bio,a.user_image&&x.submit({image:a.user_image}))}),(a,i)=>(c(),P(e(K),{options:{title:"Edit your profile",size:"xl",actions:[{label:"Save",variant:"solid",onClick:n=>w(n)}]}},{"body-content":f(()=>[t("div",null,[s.image?(c(),h("div",Pe,[t("div",Ce,p(a.__("Profile Image")),1),t("div",Ve,[t("div",Ue,[d(e(ve),{class:"h-5 w-5 stroke-1.5 text-gray-700"})]),t("div",Se,[t("span",null,p(s.image.file_name),1),t("span",je,p(e(me)(s.image.file_size)),1)]),d(e(ge),{onClick:i[1]||(i[1]=n=>v()),class:"bg-gray-200 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(c(),P(e(A),{key:0,fileTypes:["image/*"],validateFile:b,onSuccess:i[0]||(i[0]=n=>o(n))},{default:f(({file:n,progress:E,uploading:S,openFileSelector:m})=>[t("div",$e,[d(e(C),{onClick:m,loading:S},{default:f(()=>[$(p(S?`Uploading ${E}%`:"Upload a profile image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),d(e(j),{modelValue:s.first_name,"onUpdate:modelValue":i[2]||(i[2]=n=>s.first_name=n),label:a.__("First Name"),class:"mb-4"},null,8,["modelValue","label"]),d(e(j),{modelValue:s.last_name,"onUpdate:modelValue":i[3]||(i[3]=n=>s.last_name=n),label:a.__("Last Name"),class:"mb-4"},null,8,["modelValue","label"]),d(e(j),{modelValue:s.headline,"onUpdate:modelValue":i[4]||(i[4]=n=>s.headline=n),label:a.__("Headline"),class:"mb-4"},null,8,["modelValue","label"]),d(e(j),{type:"textarea",modelValue:s.bio,"onUpdate:modelValue":i[5]||(i[5]=n=>s.bio=n),label:a.__("Bio")},null,8,["modelValue","label"])])]),_:1},8,["options"]))}},Te={class:"absolute left-1/2 mt-3 w-96 max-w-lg -translate-x-1/2 transform rounded-lg bg-white px-4 sm:px-0 lg:max-w-3xl"},Fe={class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},Ie={class:"flex items-center justify-center space-x-2"},Be={class:""},Ne={class:"relative mt-2 grid w-[25.5rem] gap-2 bg-white lg:grid-cols-2"},Re=["onClick"],Le=["src"],ze={key:0,class:"mt-2 text-center text-sm text-gray-500"},Ae={class:"underline",target:"_blank",href:"https://unsplash.com"},Me={__name:"EditCoverImage",emits:["select"],setup(_,{emit:u}){const l=T(null),s=u,x=U({url:"lms.lms.api.get_unsplash_photos",makeParams:()=>({keyword:l.value}),auto:!0,debounce:500});z(()=>l.value,()=>{x.reload()});const g=b=>{s("select",b.file_url)},w=b=>{let o=b.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(o))return"Only image file is allowed."};return(b,o)=>(c(),P(e(ee),{transition:"default"},{target:f(({isOpen:v,togglePopover:a})=>[X(b.$slots,"default",Y(Z({isOpen:v,togglePopover:a})))]),body:f(()=>[t("div",Te,[t("div",Fe,[t("div",Ie,[d(e(Q),{type:"text",placeholder:"search by keyword",modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=v=>l.value=v),debounce:300,class:"flex-1"},null,8,["modelValue"]),d(e(A),{fileTypes:["image/*"],validateFile:w,onSuccess:o[1]||(o[1]=v=>g(v))},{default:f(({file:v,progress:a,uploading:i,openFileSelector:n})=>[t("div",Be,[d(e(C),{onClick:n,loading:i},{default:f(()=>[$(p(i?`Uploading ${a}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})]),t("div",Ne,[(c(!0),h(M,null,W(e(x).data,v=>(c(),h("button",{key:v.id,class:"h-[50px] w-[200px] overflow-hidden rounded hover:opacity-80",onClick:a=>b.$emit("select",v.urls.raw)},[t("img",{src:v.urls.raw+"&w=200&h=50&fit=crop&crop=entropy,faces,focalpoint"},null,8,Le)],8,Re))),128))]),e(x).data?(c(),h("div",ze,[$(p(b.__("Image search powered by"))+" ",1),t("a",Ae,p(b.__("Unsplash")),1)])):V("",!0)])])]),_:3}))}},qe={key:1},De={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5"},He={class:"group relative h-[130px] w-full"},Oe=["src"],Ge={key:2,class:"absolute bottom-0 left-1/2 mb-4 flex -translate-x-1/2 space-x-2 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100"},Je={class:"mx-auto -mt-10 md:-mt-4 max-w-4xl translate-x-0 px-5"},Ke={class:"flex flex-col md:flex-row items-center"},Xe=["src"],Ye={class:"ml-6"},Ze={class:"mt-2 text-3xl font-semibold text-gray-900"},Qe={class:"mt-2 text-base text-gray-700"},We={class:"mb-4 mt-6"},ia={__name:"Profile",props:{username:{type:String,required:!0}},setup(_){const{user:u}=pe(),l=R("$user"),s=re(),x=de(),g=T(""),w=T(!1),b=_;ae(()=>{l.data&&o.reload(),a()});const o=U({url:"frappe.client.get",params:{doctype:"User",filters:{username:b.username}}}),v=U({url:"frappe.client.set_value",makeParams(m){var r;return{doctype:"User",name:(r=o.data)==null?void 0:r.name,fieldname:"cover_image",value:m.url}},onSuccess(){o.reload()}}),a=()=>{let m=s.path.split("/");["certificates","roles","evaluations"].forEach(y=>{m.includes(y)&&(g.value=fe(y))}),g.value||(g.value="About")};se(()=>{if(g.value){let m={About:{name:"ProfileAbout"},Certificates:{name:"ProfileCertificates"},Roles:{name:"ProfileRoles"},Evaluations:{name:"ProfileEvaluator"}}[g.value];x.push(m)}});const i=()=>{w.value=!0},n=()=>{var m,r;return((m=l.data)==null?void 0:m.email)===((r=o.data)==null?void 0:r.email)},E=()=>{var r,y;let m=[{label:"About"},{label:"Certificates"}];return(r=l.data)!=null&&r.is_moderator&&m.push({label:"Roles"}),n()&&((y=l.data)!=null&&y.is_evaluator)&&m.push({label:"Evaluations"}),m},S=te(()=>{var r,y;return[{label:"People"},{label:(r=o.data)==null?void 0:r.full_name,route:{name:"Profile",params:{username:(y=u.doc)==null?void 0:y.username}}}]});return(m,r)=>{const y=L("router-view");return c(),h(M,null,[e(l).data?e(o).data?(c(),h("div",qe,[t("header",De,[d(e(ie),{class:"h-7",items:S.value},null,8,["items"])]),t("div",He,[e(o).data.cover_image?(c(),h("img",{key:0,src:e(o).data.cover_image,class:"h-[130px] w-full object-cover object-center"},null,8,Oe)):(c(),h("div",{key:1,class:oe([{"bg-gray-100":!e(o).data.cover_image},"h-[130px] w-full"])},null,2)),n()?(c(),h("div",Ge,[d(Me,{onSelect:r[0]||(r[0]=k=>e(v).submit({url:k}))},{default:f(({togglePopover:k})=>[d(e(C),{variant:"outline",onClick:ea=>k()},{prefix:f(()=>[d(e(N),{class:"w-4 h-4 stroke-1.5 text-gray-700"})]),default:f(()=>[$(" "+p(m.__("Edit")),1)]),_:2},1032,["onClick"])]),_:1})])):V("",!0)]),t("div",Je,[t("div",Ke,[t("div",null,[e(o).data.user_image?(c(),h("img",{key:0,src:e(o).data.user_image,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,Xe)):(c(),P(_e,{key:1,user:e(o).data,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,["user"]))]),t("div",Ye,[t("h2",Ze,p(e(o).data.full_name),1),t("div",Qe,p(e(o).data.headline),1)]),n()?(c(),P(e(C),{key:0,class:"mt-3 sm:mt-0 md:ml-auto",onClick:r[1]||(r[1]=k=>i())},{prefix:f(()=>[d(e(N),{class:"w-4 h-4 stroke-1.5 text-gray-700"})]),default:f(()=>[$(" "+p(m.__("Edit Profile")),1)]),_:1})):V("",!0)]),t("div",We,[d(e(ne),{class:"inline-block",buttons:E(),modelValue:g.value,"onUpdate:modelValue":r[2]||(r[2]=k=>g.value=k)},null,8,["buttons","modelValue"])]),d(y,{profile:e(o)},null,8,["profile"])])])):V("",!0):(c(),P(we,{key:0})),d(Ee,{modelValue:w.value,"onUpdate:modelValue":r[3]||(r[3]=k=>w.value=k),reloadProfile:e(o),"onUpdate:reloadProfile":r[4]||(r[4]=k=>le(o)?o.value=k:null),profile:e(o)},null,8,["modelValue","reloadProfile","profile"])],64)}}};export{ia as default};
//# sourceMappingURL=Profile-DZlUjycZ.js.map
