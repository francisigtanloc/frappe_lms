var K=Object.defineProperty;var S=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var U=(m,n,i)=>n in m?K(m,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[n]=i,V=(m,n)=>{for(var i in n||(n={}))A.call(n,i)&&U(m,i,n[i]);if(S)for(var i of S(n))G.call(n,i)&&U(m,i,n[i]);return m};import{r as H,a as J,s as X,k as v,w as q,j as Q,$ as W,x as _,y,B as a,N as r,A as t,G as h,H as g,F as $,C as u,J as Y,K as Z,aE as ee,d as se,S as le,a9 as oe,I as k,ai as d,ar as ae,aa as E,aw as te}from"./frappe-ui-CgFK8870.js";import{d as C,i as re}from"./index-GARLdoCV.js";import{_ as ie}from"./Link-IMATFM6Y.js";import{_ as ne}from"./CourseOutline-k6WN1oWr.js";import{F as ue}from"./file-text-DHp4eWlu.js";import{X as P}from"./x-KQP2i48Y.js";import"./plus-CsLQFB36.js";import"./chevron-right-jcxn7em3.js";import"./check-t5WR0f1n.js";const de={class:""},me={class:"grid md:grid-cols-[70%,30%] h-full"},ce={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5"},pe={class:"flex items-center mt-3 md:mt-0"},_e={class:"mt-5 mb-10"},be={class:"container mb-5"},fe={class:"text-lg font-semibold mb-4"},ge={class:"mb-4"},ve={class:"mb-1.5 text-sm text-gray-700"},ye={class:"mb-4"},Ce={key:1,class:"mb-4"},Ve={class:"text-xs text-gray-600 mb-1"},he={class:"flex items-center"},ke={class:"border rounded-md p-2 mr-2"},xe={class:"flex flex-col"},we={class:"text-sm text-gray-500 mt-1"},Ne={class:"mb-1.5 text-xs text-gray-600"},Se={class:"flex items-center"},Ue={class:"flex items-center bg-gray-100 p-2 rounded-md mr-2"},$e={class:"container border-t"},Ee={class:"text-lg font-semibold mt-5 mb-4"},Pe={class:"flex items-center justify-between mb-4"},Te={class:"container border-t"},je={class:"text-lg font-semibold mt-5 mb-4"},Fe={class:"mb-4"},De={class:"border-l pt-5"},He={__name:"CreateCourse",props:{courseName:{type:String}},setup(m){const n=se("$user"),i=H(""),x=le(),b=m,l=J({title:"",short_introduction:"",description:"",video_link:"",course_image:null,tags:"",published:!1,published_on:"",upcoming:!1,disable_self_learning:!1,paid_course:!1,course_price:"",currency:""});X(()=>{var e,s;!((e=n.data)!=null&&e.is_moderator)&&!((s=n.data)!=null&&s.is_instructor)&&x.push({name:"Courses"}),b.courseName!=="new"&&c.reload()});const T=v({url:"frappe.client.insert",makeParams(e){return{doc:V({doctype:"LMS Course",image:l.course_image.file_url},e)}}}),j=v({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"LMS Course",name:e.course,fieldname:V({image:l.course_image.file_url},l)}}}),c=v({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Course",name:b.courseName}},auto:!1,onSuccess(e){Object.keys(e).forEach(p=>{Object.hasOwn(l,p)&&(l[p]=e[p])});let s=["published","upcoming","disable_self_learning","paid_course"];for(let p in s){let f=s[p];l[f]=!!l[f]}e.image&&F.reload({image:e.image})}}),F=v({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.course_image=e}}),D=()=>{c.data?j.submit({course:c.data.name},{onSuccess(){C("Success","Course updated successfully","check")},onError(e){var s;C("Error",((s=e.messages)==null?void 0:s[0])||e,"x")}}):T.submit(l,{onSuccess(e){C("Success","Course created successfully","check"),x.push({name:"CreateCourse",params:{courseName:e.name}})},onError(e){C(e)}})};q(()=>b.courseName!=="new",e=>{e&&c.reload()});const R=e=>{let s=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(s))return"Only image file is allowed."},B=()=>{i.value&&(l.tags=l.tags?`${l.tags}, ${i.value}`:i.value,i.value="")},I=e=>{var s;l.tags=(s=l.tags)==null?void 0:s.split(", ").filter(p=>p!==e).join(", "),i.value=""},L=e=>{l.course_image=e},M=()=>{l.course_image=null},O=Q(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return c.data&&e.push({label:l.title,route:{name:"CourseDetail",params:{courseName:b.courseName}}}),e.push({label:b.courseName=="new"?"New Course":"Edit Course",route:{name:"CreateCourse",params:{courseName:b.courseName}}}),e});return(e,s)=>{var f;const p=W("router-link");return _(),y("div",de,[a("div",me,[a("div",null,[a("header",ce,[r(t(oe),{class:"h-7",items:O.value},null,8,["items"]),a("div",pe,[t(c).data?(_(),h(p,{key:0,to:{name:"CourseDetail",params:{courseName:t(c).data.name}}},{default:g(()=>[r(t(k),null,{default:g(()=>[a("span",null,u(e.__("View Course")),1)]),_:1})]),_:1},8,["to"])):$("",!0),r(t(k),{variant:"solid",onClick:s[0]||(s[0]=o=>D()),class:"ml-2"},{default:g(()=>[a("span",null,u(e.__("Save")),1)]),_:1})])]),a("div",_e,[a("div",be,[a("div",fe,u(e.__("Details")),1),r(t(d),{modelValue:l.title,"onUpdate:modelValue":s[1]||(s[1]=o=>l.title=o),label:e.__("Title"),class:"mb-4"},null,8,["modelValue","label"]),r(t(d),{modelValue:l.short_introduction,"onUpdate:modelValue":s[2]||(s[2]=o=>l.short_introduction=o),label:e.__("Short Introduction"),class:"mb-4"},null,8,["modelValue","label"]),a("div",ge,[a("div",ve,u(e.__("Course Description")),1),r(t(ae),{content:l.description,onChange:s[3]||(s[3]=o=>l.description=o),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-gray-100 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),l.course_image?(_(),y("div",Ce,[a("div",Ve,u(e.__("Course Image")),1),a("div",he,[a("div",ke,[r(t(ue),{class:"h-5 w-5 stroke-1.5 text-gray-700"})]),a("div",xe,[a("span",null,u(l.course_image.file_name),1),a("span",we,u(t(re)(l.course_image.file_size)),1)]),r(t(P),{onClick:s[5]||(s[5]=o=>M()),class:"bg-gray-200 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(_(),h(t(te),{key:0,fileTypes:["image/*"],validateFile:R,onSuccess:s[4]||(s[4]=o=>L(o))},{default:g(({file:o,progress:w,uploading:N,openFileSelector:z})=>[a("div",ye,[r(t(k),{onClick:z,loading:N},{default:g(()=>[E(u(N?`Uploading ${w}%`:"Upload an image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),r(t(d),{modelValue:l.video_link,"onUpdate:modelValue":s[6]||(s[6]=o=>l.video_link=o),label:e.__("Preview Video"),class:"mb-4"},null,8,["modelValue","label"]),a("div",null,[a("div",Ne,u(e.__("Tags")),1),a("div",Se,[(_(!0),y(Y,null,Z((f=l.tags)==null?void 0:f.split(", "),o=>(_(),y("div",Ue,[E(u(o)+" ",1),r(t(P),{class:"stroke-1.5 w-3 h-3 ml-2 cursor-pointer",onClick:w=>I(o)},null,8,["onClick"])]))),256)),r(t(d),{modelValue:i.value,"onUpdate:modelValue":s[7]||(s[7]=o=>i.value=o),onKeyup:s[8]||(s[8]=ee(o=>B(),["enter"]))},null,8,["modelValue"])])])]),a("div",$e,[a("div",Ee,u(e.__("Settings")),1),a("div",Pe,[r(t(d),{type:"checkbox",modelValue:l.published,"onUpdate:modelValue":s[9]||(s[9]=o=>l.published=o),label:e.__("Published")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.upcoming,"onUpdate:modelValue":s[10]||(s[10]=o=>l.upcoming=o),label:e.__("Upcoming")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.disable_self_learning,"onUpdate:modelValue":s[11]||(s[11]=o=>l.disable_self_learning=o),label:e.__("Disable Self Enrollment")},null,8,["modelValue","label"])]),r(t(d),{modelValue:l.published_on,"onUpdate:modelValue":s[12]||(s[12]=o=>l.published_on=o),label:e.__("Published On"),type:"date",class:"mb-5"},null,8,["modelValue","label"])]),a("div",Te,[a("div",je,u(e.__("Pricing")),1),a("div",Fe,[r(t(d),{type:"checkbox",modelValue:l.paid_course,"onUpdate:modelValue":s[13]||(s[13]=o=>l.paid_course=o),label:e.__("Paid Course")},null,8,["modelValue","label"])]),r(t(d),{modelValue:l.course_price,"onUpdate:modelValue":s[14]||(s[14]=o=>l.course_price=o),label:e.__("Course Price"),class:"mb-4"},null,8,["modelValue","label"]),r(ie,{doctype:"Currency",modelValue:l.currency,"onUpdate:modelValue":s[15]||(s[15]=o=>l.currency=o),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])])])]),a("div",De,[t(c).data?(_(),h(ne,{key:0,courseName:t(c).data.name,title:l.title,allowEdit:!0},null,8,["courseName","title"])):$("",!0)])])])}}};export{He as default};
//# sourceMappingURL=CreateCourse-DpnuTqmh.js.map
